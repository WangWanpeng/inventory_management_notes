\newcommand{\Q}{S}

\section{Newsvendor Models}
\label{sec:newsvendor-models}


%\input{nw_functions.tex}\nvf{to do}

\Opensolutionfile{ans}

Perhaps the most well-known stochastic inventory model is the \recall{newsvendor} or \recall{newsboy} model.  In this model there is a  newsvendor who buys newspapers early in the morning, before observing the demand, and then tries to sell these papers during the day. 
The product here is perishable as newspapers often not have much value the day after they are printed. %Therefore, the newsvendor should plan his operations on a daily basis. 
Clearly,  the newsvendor's problem is to match the supply to the demand on a daily basis while maximizing the expected profit or minimizing the expected cost. Interestingly, this problem is much more general than its name might indicate; it applies in familiar settings such as bread selling, but it also pops up  in quite unexpected situations such as bed reservations in hospitals. 


In the next sections we first analyze the newsvendor model for deterministic demand. Then we generalize to stochastic demand.
% and consider a number of extensions that are relevant in practical applications. These extensions also clearly illustrate the effect of demand uncertainty in inventory decisions. 
Finally, we consider a newsvendor problem with two periods. This is not only a relevant problem for, for instance, supermarkets that bake bread twice a day, once to match the morning demand and part of the afternoon demand, the second time to meet the afternoon demand. It is also the simplest extension to inventory systems with a long horizon, that is, systems in which items can be kept for much longer time. 

We expect that the reader checks Appendix~\ref{sec:appendix} at this point as we use this material heavily henceforth.

\subsection{Newsvendor policy, main characteristics}
\label{sec:policy-parameters}

In more general terms, the newsvendor  inventory system behaves as follows. Right before the start of a period, the vendor places an order for items at the cost of $c$ per item. These items are received right after the start of the period, but before any demand arrives. Items sell at a price $p$ per item. Finally any items remaining at the end of the period are salvaged at price $s$. The problem is to determine the optimal inventory level at which to start the period. 

It is important to observe that in this model we interpret the starting inventory level as an \recall{order-up-to level}, and not as an order quantity. At this point, this may seem a strange: since we start afresh every period, placing an order up to level $S$, say, comes down to ordering an amount $Q=S$. However, as we will see in the analysis of multi-period problems in which unsold items carry over from one period to another, it is much easier to think in terms of order-up-to levels: these levels typically remain constant, while the order quantities depend on the order-up-level and the number of items unsold at the end of the period. Thus, to show the relation between all these models, we chose to formulate the one-period newsvendor inventory problem also in terms of  order-up-to policies.  As a consequence,  our aim is to  determine the optimal order-up-to levels for each period. 

Before we start the analysis of the inventory system, let us make a list of the relevant cost and policy parameters: 
\begin{align*}
  c &= \text{Buying price of one item,} \\
  p &= \text{Selling  price of one item,} \\
  s &= \text{Salvage (end) value of one item}, \\
  h &= \text{Overage cost of one item at the end of a period},\\
  b &= \text{Shortage cost of one item at the end of a period}, \\
  S &= \text{Order-up-to level, received at the start of a period}.
\end{align*}
Observe that, costs for \recall{overage}, i.e., inventory unsold at the end of the period, or \recall{underage}, i.e., lost sales, are linear.  

We next discuss some properties of these parameters.
\begin{exercise}
  In the models below we assume that each item unsold at the end of the period can be salvaged  at a price $s$ per item. Can $s$ also be negative?
  \begin{solution}
    Yes, when there is a cost associated with disposing any unsold items. 
  \end{solution}
\end{exercise}

\begin{exercise}
  Why is it reasonable to require that $p > c > s$? 
\begin{solution}
We must have $p>c>s$ because if $p\leq c$ we would not buy anything as there would be no way of making profit, and if $c<s$ we would buy as much as possible as it would lead to more profit. 
\end{solution}
\end{exercise}

\begin{exercise}
Explain that 
\begin{align}\label{eq:133}
h&=c-s, & b&=p-c.
\end{align}
Are both parameters positive?
\begin{solution}
In case of an overage; an item that is bought for $c$ was not sold and therefore salvaged at a price of $s$. The loss due to this item is therefore $h=c-s$. In case of a shortage; a unit of demand is not satisfied leading to a loss of $p$ from profit, but as no item was bought in the first place this loss is reduced by $c$. The net loss is thus $b=p-c$. Observe that both $h$ and $b$ are positive if $p>c>s$.
\end{solution}
\end{exercise}



\subsection{Newsvendor problem with deterministic demand}

Here we will derive, with a number of steps,  a function $P$ that shows how the profit per period depends on on the order-up-to level $S$. Then, by making a graph of $P$, we can search for the optimal order-up-to level.

Let us assume that the newsboy order up to level $\Q$ so that right after the period starts, the inventory level contains $\Q$ items. Suppose further that period demand is $d$ items. 

\begin{exercise}
Motive that $\min\{\Q,d\}$ is the number of items sold.
\begin{solution}
If $d<\Q$, we only sell $d$. If $d\geq \Q$, we cannot sell more than we have. Thus, we can only sell the minimum of the two.
\end{solution}
\end{exercise}


\begin{exercise}
Explain that the number of items salvaged is $\Q-\min\{\Q,d\}$. 
\begin{solution}
$\Q$ is the amount ordered, and $\min\{\Q, d\}$ is the amount sold. Hence the difference is the amount remaining (unsold) at the end of the period. 
\end{solution}
\end{exercise}

\begin{exercise}
Use the previous exercise to show that the number of items salvaged can be rewritten 
in an easier format:
\begin{align*}
(\Q-d)^+.
\end{align*}
\begin{solution}
We need to check that $\Q-\min\{\Q,d\} = (\Q-d)^+$. Testing it with some numbers: if $\Q=5$ and $d=2$, it checks, if $\Q=5$ and $d=7$. it also checks. In general, it follows from Exercise~\ref{ex:6} 
\end{solution}
\end{exercise}


Define the newsvendor's \recall{profit function} as 
\begin{align*}
P(\Q, d) = -c \Q + p\min\{\Q,d\} + s(\Q-d)^+.
\end{align*}

\begin{exercise}
Explain this.
\begin{solution}
  It costs $c \Q$ to buy the items, hence a profit of $-c \Q$. The number of sold items bring in a profit of $p\min\{\Q, d\}$, the items salvaged bring in a profit of $s(\Q-d)^+$. Adding these three components leads to the result.
\end{solution}
\end{exercise}

\begin{exercise}
Show that $P(\Q, d)$ can also be written in the following useful format:
\begin{align}\label{eq:27}
P(\Q, d) 
%&= (p-c)\Q - (p-s)(\Q-d)^+ \\
&= b \Q - (b+h)(\Q-d)^+.
\end{align}
\begin{solution}
  \begin{align*}
P(\Q) 
&= -c \Q + p\min\{\Q,d\} + s(\Q-d)^+.\\
&= (p-c)\Q - p(\Q-\min\{\Q,d\}) + s(\Q-d)^+.\\
&= (p-c)\Q - p(\Q-d)^+ + s(\Q-d)^+.\\
&= (p-c)\Q - (p-s)(\Q-d)^+.
  \end{align*}
\end{solution}
\end{exercise}


We started by formulating the newsvendor problem as a `profit maximization' problem, but we can also formulate it as a `minimization' model.  Define the newsvendor's \recall{loss function} as 
\begin{align}\label{eq:23}
L(\Q,d ) = h(\Q-d)^+ + b(d-\Q)^+.
\end{align}

\begin{exercise}
Then show that 
\begin{equation}\label{eq:24}
P(\Q, d) = (p-c)d - L(\Q, d) = b d - L(\Q, d),
\end{equation}
and  interpret this result.
\begin{solution}
    Here we go:
    \begin{align*}
L(\Q, d) 
&= h(\Q-d)^+ + b(d-\Q)^+ \\
&= (c-s)(\Q-d)^+ (p-c)(d-\Q)^+ \\
&= c((\Q-d)^+ - (\Q-d)^-) -s (\Q-d)^+ + p(d-\min\{d,\Q\}) \\
&= c(\Q-d) -s (\Q-d)^+ + p(d-\min\{\Q,d\}) \\
&= c\Q -s (\Q-d)^+ - p \min\{\Q,d\} + (p-c)d \\
&= -P(\Q, d) + (p-c)d\\
&= bd -P(\Q,d ).
    \end{align*}
Hence, $P(\Q, d) = b d - L(\Q, d)$, telling us that the profit is equal to $b d$ minus the loss. Notice that $b d$ is the maximum possible profit from sales, that is, we cannot sell more than the demand, and each unit sold gives a profit of $b= p-c$. The relation therefore states that the profit is  the maximum possible profit minus the loss. 

Note, the loss function is \emph{not} the cost per period of the newsvendor: its the loss with respect to the maximal possible profit. 
  \end{solution}
\end{exercise}

\begin{exercise}
Why does a  loss minimization lead to the same $\Q^*$ as a profit maximization?
\begin{solution}
We know that $P(\Q) = b d - L(\Q)$. But $b d$ is a constant unaffected by $\Q^*$. Therefore, if $\Q^*$  minimizes $L$, it is also maximizes $P$. 
\end{solution}
\end{exercise}


\begin{exercise}\label{ex:nw_det}
Let $d=20$, $h=1$€ and $b=10$€. Implement $L(\Q, d)$ in excel and plot the loss function for different values of $\Q$. 
% Above is the euro symbol, ready to copy.
\begin{solution}
Here is the graph.
\begin{pycode}[news]
def L(x):
    return 10*np.maximum(20-x, 0) + np.maximum(x-20,0)

x = np.arange(0, 40, 1)

plt.figure(figsize=(5, 4))
plt.plot(x, L(x), label="$L(S)$")
plt.xlabel("$S$")
plt.ylabel("Loss")
plt.legend()
filename = "figures/Ldeter.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\centering
\includegraphics{figures/Ldeter.pdf}
\end{solution}
\end{exercise}

\begin{exercise}
What is the newsvendor's optimal level $\Q^*$ for the situation of the previous exercise? 
\begin{solution}
The optimal level is obviously 20, a we know that the demand is 20 units anyway. 
\end{solution}
\end{exercise}

\begin{exercise}
What would be the loss if this $\Q^*$ is used? 
\begin{solution}
The newsvendor's loss will be zero for $\Q=20$. 
\end{solution}
\end{exercise}

\begin{exercise}
How would the loss be affected if the vendor were to buy one unit less or one unit more than $\Q^*$?
\begin{solution}
Having a unit more will exactly increase the loss by $h$ and a unit less by $b$. 
\end{solution}
\end{exercise}

\begin{exercise} Just to practice with the formulas, 
let the newsvendor's selling price be €15 in the previous exercise. Write down the profit and loss functions for $\Q=7$ and $\Q=26$ and compare the results.
\begin{solution}
Noting that $h=c-s=1$ and $b=p-c=10$, and as $p=15$; we have that $c=5$ and $s=4$. Thus, we obtain the profit function
\begin{align*}
P(\Q) 
&= (p-c)\Q - (p-s)(\Q-d)^+ \\
&= 10 \Q - 11 (\Q-20)^+, & d=20.
%\min\{\Q,d\} + s(\Q-\min\{\Q,d\}) = -5\cdot \Q + 15\cdot\min\{\Q,20\} + 4\cdot(\Q-\min\{\Q,20\})
\end{align*}
For the loss function
\begin{align*}
L(\Q) = h(\Q-d)^+ + b(d-\Q)^+ = 1\cdot (\Q-20)^+ + 10\cdot(20-\Q)^+.
\end{align*}

Then; for $\Q=7$ we obtain profit $10*7 - 11*0 =70$ and cost \$130, and for $\Q=26$ we have $10*26-11*6 = 194$ for profit and $1*6 + 10*0 = 6$ for loss. Indeed, in botch cases, profit and loss functions sum up to the maximum possible profit $(p-c)d=(15-5)\cdot 20=200$.
\end{solution}
\end{exercise}

To summarize, we have found an expression of the profit and the loss for a newsvendor who operates in an environment in which the demand is perfectly known. In the next section we make this model more realistic by modeling demand as a random variable. The above formulas will need to be modified a bit, but the reasoning behind remains the same. 

\subsection{Newsvendor problem with stochastic discrete demand}
\label{sec:stoch-discr-demand}

We now investigate the newsvendor problem with stochastic demand. To that end, we replace the deterministic demand $d$ with  the random demand $D$  of units sold on a particular period. We assume that the probability mass function (pmf) $f(i) = \P{ D = i}$ is given; in other words, the vendor knows the probability that a certain demand occurs, not the demand itself.  Again we will work towards a loss function and make plots to find the optimal level $\Q^*$. We refer to the appendix for relevant background in probability theory.


To familiarize ourselves with the formulas to come, we illustrate the relevant concepts with a simple case and simulation. 
\begin{exercise}\label{ex:9}
Assume that demand is like this $(1, 4, 4, 1, 4)$, and $\Q = 2$. Then show that the average profit per period can be written as
\begin{equation*}
\frac 2 5 P(2, 1) + \frac 3 5 P(2, 4),
\end{equation*}
where $P(\Q, d)$ is as in~\eqref{eq:27}. 
\begin{solution}
  When the demand is $4$ the profit is $P(2, 4)$, while it is $P(2, 1)$ is the demand is $1$. Now $2$ out of $5$ times we saw a demand of $1$, and in each of these cases we made a profit of $P(2, 1)$, and likewise for the case with demand $4$. 
\end{solution}
\end{exercise}

Lets make this a bit more formal. This is not only conceptually useful, its also practical because we use this to instruct  the computer to carry out the computations for us. Define the \recall{indicator} function\footnote{See the appendix.}
as \begin{equation*}
\1{D_n=i} = 
  \begin{cases}
    1, &\text{if } D_n=i, \\
    0, &\text{if } D_n\neq i.
  \end{cases}
\end{equation*}
Suppose now that we observe (or simulate) the newsvendor for $N$ days. Then the average profit made is
\begin{equation*}
P(\Q) = \frac 1 N \sum_{n=0}^{N} P(\Q, D_n).
\end{equation*}
But now realize that every time $D_n=i$, the newsvendor makes the same profit. Thus, we can collect all periods in which the profit is $P(\Q, i)$ and then just count how often this occurred. With this idea, we can rewrite the average profit in terms of indicators: 
\begin{equation*}
P(\Q) = \sum_{i\geq 0} P(S, i)\left( \frac 1 N \sum_{n=1}^{N} \1{D_n=i}\right).
\end{equation*}
As a final step. writing the fraction of times $D_n=i$ as 
\begin{equation*}
 \frac 1 N \sum_{n=1}^{N} \1{D_n=i} = f(i),
\end{equation*}
we get
\begin{equation}\label{eq:29}
P(\Q) = \sum_{i\geq 0} P(S, i) f(i) =: \E{P(S, D)},
\end{equation}
where the last expression is just an easy shorthand. 


\begin{exercise}[Continuation of Ex.\ref{ex:9}] Show that $N^{-1} \sum_{n=0}^{N} \1{D_n=4}=3/5$. 
  \begin{solution}
Take $i=4$. Then
\begin{align*}
\frac 1 N \sum_{n=0}^{N} \1{D_n=i} 
&= \frac 1 5 \sum{n=1}^5 \1{D_n=4} \\
&=\frac 1 5 \left(\1{D_1=4} + \1{D_2=4} + \1{D_3=4} + \1{D_4=4} + \1{D_5=4} \right)\\
&=\frac 1 5 \left(0 + 1 + 1 + 0 + 1 \right).
\end{align*}
  \end{solution}
\end{exercise}



\begin{exercise}
  Use the formulas of the appendix to write $\E{(\Q-D)^+}$ and $\E{(D-\Q)^+}$ as summations in terms of the probabilities $f(i) = \P{D=i}$. Ensure you know how to implement this in, for instance, excel.
  \begin{solution}
\begin{align*}
  \E{ (\Q-D)^+}
  &= \sum_{i=0}^\infty (\Q-D)^+\P{D=i}\\
  &= \sum_{i=0}^\infty (\Q-i)^+ f(i)\\
  &= \sum_{i=0}^\Q (\Q-i) f(i) & (\Q-i)^+=0\text{ if } i \geq \Q\\
  &= (\Q-0) f(0) + (\Q-1)f(1)+ \cdots + \\
&\quad (\Q-(\Q-1))f(\Q-1) + (\Q-\Q)f(\Q) \\
  &= (\Q-0) f(0)+ (\Q-1)f(1)+ \cdots + \\
&\quad(\Q-(\Q-1))f(\Q-1)\\
  &= \sum_{i=0}^{\Q-1} (\Q-i) f(i) \\
\end{align*}
Likewise
\begin{align*}
  \E{ (D-\Q)^+}
  &= \sum_{i=0}^\infty (D-\Q)^+\P{D=i}\\
  &= \sum_{i=\Q}^\infty (i-\Q)^+ f(i)\\
  &= \sum_{i=\Q+1}^{\infty} (i-\Q) f(i).
\end{align*}
Observe in this last summation that, formally, we have to carry out a summation to infinity. In real life, demand is always finite. Suppose that $\bar D$ is the largest possible demand. Then the above reduces to
\begin{align*}
  \E{ (D-\Q)^+}= \sum_{i=\Q+1}^{\bar D} (i-\Q) f(i),
\end{align*}
since $f(i)=0$ for $i>M$.   In the notation below we typically write $\infty$ so that we do not have to specify $\bar D$. However, we always have in the back of our mind that the summation is finite.
  \end{solution}
\end{exercise}


\begin{exercise}
  Let $\Q=3$ and  $f(1)=f(2)\ldots=f(5) = 1/5$. Compute the expected lost sales $\E{(D-\Q)^+}$.
  \begin{solution}
    \begin{align*}
      \E{(D-\Q)^+} &= \sum_{i=\Q+1}^5 (i-\Q) f(i) = \frac{4-3}5 + \frac{5-3}5\\
    \end{align*}
  \end{solution}
\end{exercise}

\begin{exercise}[continuation]
 Compute now the expected number salvaged $\E{(\Q-D)^+}$.
  \begin{solution}
    \begin{align*}
      \E{(\Q-D)^+} &= \sum_{i=1}^{\Q-1} (\Q-i) f(i) = \frac{3-1}5 + \frac{3-2}5.
    \end{align*}
  \end{solution}
\end{exercise}

Define the \emph{expected total loss} when the newsvendor uses level $S$ as
\begin{align}\label{eq:59}
L(\Q) = h\E{(\Q-D)^+} + b\E{(D-\Q)^+}.
%&= h\sum_{i=0}^{\Q-1} (\Q-i)f(i) + b \sum_{i=\Q+1}^\infty (i-\Q)f(i).
\end{align}

\begin{exercise}
Motivate this definition.
\begin{solution}
We can  simply apply the expectation operator to $h(\Q-D)^+ + b(D-\Q)^+$ to get the result.

It is important to know that, in general, this expression cannot be reduced to a simple form. However, it is easy to implement in spreadsheet applications.
\end{solution}
\end{exercise}

\begin{exercise}
Suppose $c = 5$, $p=10$, $s=3$,  and that the daily demand is $D\in \{0,1\}$ with $f(0) = f(1) =1/2$. What is $L(0)$, i.e., the loss if you would choose order $\Q=0$ 
\begin{solution}
First note that $h=c-s=5-3=2$, $b=p-c=10-5=5$. Next, $(\Q-D)^+=(0-D)^+=0$, and
\begin{align*}
  \E{(\Q-D)^-}
&= (0-0)f(0) + (0-1)^-f(1) = 1f(1) = \frac 1 2.
\end{align*}
Hence, the loss is $h\cdot 0 + b \cdot 1/2 = 5/2$.
\end{solution}
\end{exercise}

\begin{exercise}[Continuation]  What is the loss if $\Q=1$?  Hence, what is the optimal choice for $\Q$?
\begin{solution}
\begin{align*}
&h\E{(1-D)^+} + h\E{(1-D)^-} \\
&= h (1-0)f(0) + h(1-1)^+f(1) + b (1-0)^-f(0) + b(1-1)^-f(1) \\
&= 2\cdot1\cdot\frac 1 2 + 0 + 0 + 0 \\
&=1
\end{align*}
This is smaller than $5/2$. Hence, $\Q^*=1$, as this minimizes the loss.
\end{solution}
\end{exercise}

\begin{exercise}\label{ex:10}
To understand the effect of variability in the demand we compare the graphs of the loss for the case in which the  demand  $D$ has pmf $f(6)=f(7)=\ldots=f(16)=\frac{1}{11}$ to a case in which  the demand is constant and equal to $\theta = \E D = 11$. Show that for the latter case, the loss function $L(\Q, 11) = h(\Q-11)^+ + b(11-\Q)^+$. Make a plot for the case $h=1$ and $b=10$. 
  \begin{solution}
In this exercise  the demand to be always equal to 11, hence its pmf $g(11) = 1$, and $g(i)=0$ for $i\neq 11$. But then
\begin{align*}
  L'(\Q) 
&=h\sum_{i=0}^\infty(\Q-i)^+ g(i) + b\sum_{i=0}^{\infty}(i-\Q)^+ g(i) \\
&=h(\Q-11)^+  + b(11- \Q)^+,
\end{align*}
since there is only a probability mass at $i=11$.

For the graph, see the next exercise.
  \end{solution}
\end{exercise}

\begin{exercise}[Continuation]\label{ex:55}
Implement $L(\Q)$ in excel and plot $L(\Q)$ for different values of $\Q$ and compare this with the loss $L'(\Q)$ for the deterministic case. What is~$\Q^*$?
\begin{solution}
The mean demand is 11. See the Figure; $L$ is the loss for the stochastic demand, $L'$ the loss for the deterministic case.

  
\begin{pycode}[news]
h = 1
b = 10
left = 6
right = 16

def f(i):
    if left <= i <= right:
        return 1./(right-left+1)
    else:
        return 0

def L(q):
    term1 = h*sum((q-i)*f(i) for i in range(0, q))
    term2 = b*sum((i-q)*f(i) for i in range(q, right+1))
    return term1 + term2

X = range(21)
LL = []
for q in X:
    LL.append(L(q))

# deterministic case
theta = sum(i*f(i) for i in range(0, right+1))
def Lp(x):
    return b*max(theta-x, 0) + h*max(x-theta,0)

Ldet = []
for q in X:
    Ldet.append(Lp(q))

plt.figure(figsize=(5, 4))
plt.plot(X, LL, label="$L(S)$")
plt.plot(X, Ldet, label="$L'(S)$")
plt.xlabel("$S$")
plt.ylabel("Loss")
plt.legend()
filename = "figures/Lexp.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\begin{center}
\includegraphics{figures/Lexp.pdf}
\end{center}


It is apparent from the graph that the optimal order level $\Q^*$ is 15 or 16. Note that this is considerably higher than the mean demand $\theta = 11$. 
\end{solution}
\end{exercise}
 


\begin{exercise}[Continuation]
To explain the left part of the figure of the previous exercise, suppose that the demand can be big, e.g., $D\in\{0,1,\ldots, 1000\}$, and $f(i) = 1/1001$. What is the slope of $L(\Q)$ for $\Q$ small? (BTW, why do we take $f(i)=1/1001$ and not $1/1000$?) 
\begin{solution}
  If $\Q=1$ it is very unlikely that the item will not be sold. In fact, we are nearly sure it will be sold, hence, the slope of $L$ for small $\Q$ must be $-b$, i.e., the price of selling the item minus the price to buy it.

For the other question, realize that the number of integers from $0, \ldots, 1000$ is $1001$, not 1000.
\end{solution}
\end{exercise}
 
\begin{exercise}[Continuation] To explain the right  part of the figure of Ex.\ref{ex:55}.
what is the slope of $L(\Q)$ if $\Q$ is big, i.e., near 1000? 
\begin{solution}
If $\Q$ is very large, we are pretty sure the `last item' will not be sold, hence, the slope must be $h=c-s$. 
\end{solution}
\end{exercise}

Clearly, by computing $L(\Q)$ for $\Q=0, 1, \ldots, \bar D$, with $\bar D$ the largest possible demand, we can find the optimal order level $\Q^*$. There is, however, a faster, and easier, way. As the loss function $L$ is convex, it is easy to prove (although we omit it) that 
$\Q$ can be found from the \recall{critical fraction formula}
\begin{equation}\label{eq:255}
\Q^* = \min\left\{\Q : F(\Q)\geq \frac{b}{h+b}\right\},
\end{equation}
that is, $\Q^*$ is the smallest $\Q$ such that $F(\Q) \geq b/(b+h)$, where $F(\cdot)$ is the distribution function of the demand. Note that this formula is not generally valid; for instance, when there are restrictions on the number of items that can be salvaged, this formula is not true. In general, it is best to start from the loss (or profit) function, and search for its minimum (maximum).

\begin{exercise}
Show that the critical fraction formula can also be written as
\begin{equation*}
\Q^* = \min\left\{\Q : F(\Q)\geq \frac{p-c}{p-s}\right\},
\end{equation*}
\begin{solution}
Use Eqs.~\eqref{eq:133} and \eqref{eq:255}.
\end{solution}
\end{exercise}

\begin{exercise}
  Consider an example with daily demand $D\in \{0,1,2\}$, with 
 $f(0) = \P{D=0}=1/4$, $f(1)=1/3$, $f(2)=5/12$, and $b=5$ and $h=3$. Show that $\Q^*=2$.
\begin{solution}
First compute the distribution function $F$:
\begin{align*}
  F(0) &= f(0) = \frac 1 4,\\
  F(1) &= F(0) +f(1)= \frac 1 4 + \frac 1 3 = \frac{7}{12},\\
  F(2) &= F(1) + f(2) = \frac 7{12}  + \frac 5 {12}  = 1.
\end{align*}
Next, $b/(b+h)=5/(5+3)=5/8$. Clearly, $F(0) < b/(b+h)$. Next, 
\begin{equation*}
  F(1) - \frac b{b+h} = \frac 7 {12} - \frac 5 8 < 0.
\end{equation*}
As the only other sensible choice is $\Q^*=2$, we use this. Of course, also $F(2)=1>5/8$. 
\end{solution}
\end{exercise}

\begin{exercise} Show for  Exercise~\ref{ex:55} that $\Q^*=15$.

\begin{solution}
 The optimal order level should satisfy 
\begin{align*}
\Q^* = \min\left\{\Q\mid F(\Q)\geq \frac{10}{1+10}\right\}.
\end{align*}

Because $F(6)=1/11, F(7)=2/11, \ldots, F(15)=10/11, F(16)=1$, the minimum order level that has a cumulative probability larger than $10/11$ is indeed $15$. 
\end{solution}
\end{exercise}

Here is a very important idea: the \recall{value of perfect information}. To explain,  suppose that, just hypothetically, that  we are able, at a large expense, to reduce the demand variability to 0. In other words, we can reduce the newsboy problem with demand variability to an entirely this deterministic case in which the demand is precisely $\theta = \E D = 11$. What would be the value of this reduction in variability? 

To understand this, we compare the optimal profit for the case with demand variability to the optimal profit without variability.  Use~\eqref{eq:24} to see that the highest possible profit is $b \theta = 10*11 = 110$. Then, define the value of perfect information as
\begin{equation*}
1-  \frac{P(\Q^*)}{b \theta} = 
1-  \frac{b \theta - L(\Q^*)}{b \theta} = 
 \frac{L(\Q^*)}{b \theta}.
\end{equation*}

\begin{exercise}
Compute the value of perfect information for the data of Ex.~\ref{ex:10} and \ref{ex:55}. What do you conclude from the fact that it is small?
\begin{solution}
\begin{pycode}[news]
Sstar = 15
value = L(Sstar)/(b*theta)
\end{pycode}
For the value of perfect information we get
\begin{equation*}
 \frac{L(\Q^*)}{b \theta} = \frac{\py[news]{L(15)}}{\py[news]{b*theta}} = 
\py[news]{"{0:.2f}".format(L(15)/(b*theta))}
\end{equation*}
This is pretty small! 

This brings us to a very important conclusion: we can try to reduce  demand variability, for instance  by asking potential customers how much they are willing to buy, using questionnaires, and so on. Of course, this will increase the profit, but by how much? Well, from the above value of perfect of information, we see however that this is not much. Even in the best possible case, i.e., precisely knowing the demand, the profit increases by some 5\%. Now we should compare this extra profit to the cost we need to make to reduce the demand variability. The latter costs are often much higher than the profit gained, which is often small, here \emph{at most} some 5\%. Thus, in more general terms, keeping the right amount of inventory obviates the need to reduce demand variability.
\end{solution}
\end{exercise}

Thus far we have assumed that all left-overs can be salvaged. This assumption might not always be vindicated in practice. To understand the effect on the loss, we model the demand for salvage items as a random variable denoted by $W$. Now, using that  $\min\{\Q-D, W\}$ is the number of  salvaged, the loss function becomes
\begin{align*}
L(\Q) 
 &= b\E{(D-\Q)^+} + (c-s) \E{(\Q-D)^+} + s \E{(\Q-D- W)^+}.
% &= -(p-c)\Q + (p-s)\E{(\Q-D)^+} + s\E{(\Q-D-W)^+}.\\
% &= -b\Q + (b+h)\E{(\Q-D)^+} + s\E{(\Q-D-W)^+}.\\
\end{align*}

\begin{exercise}  
Derive the formula above.
\begin{solution}
The main difference as compared to the original problem here is that we can at most salvage $W$ left-over items at a price of $s$; any overage in excess of $W$ is lost. To understand the impact of this, lets first consider the normal loss function
\begin{align*}
   L(\Q) 
 &= b\E{(D-\Q)^+} + h \E{(\Q-D)^+} \\
 &= b\E{(D-\Q)^+} + (c-s) \E{(\Q-D)^+} \\
 &= b\E{(D-\Q)^+} + c\E{(\Q-D)^+} - s\E{(\Q-D)^+},
 \end{align*}
so only the third term involves salvage cost. 

In the new setting, we can only salvage an amount $\E{\min\{(\Q-D)^+, W\}}$ instead of $\E{(\Q-D)^+}$. Using the rule $\min\{x, y\} = x - (x-y)^+$ we can rewrite this to
\begin{align*}
\E{\min\{(\Q-D)^+, W\}} 
&=  \E{(\Q-D)^+} - \E{((\Q-D)^+- W)^+} \\
&=  \E{(\Q-D)^+} - \E{(\Q-D- W)^+},
\end{align*}
where $((\Q-D)^+-W)^+=(\Q-D-W)^+$ because $W\geq 0$.  Thus, in the new setting:
\begin{align*}
  L(\Q) 
 &= b\E{(D-\Q)^+} + c \E{(\Q-D)^+} - s\E{\min\{(\Q-D)^+, W\}} \\
 &= b\E{(D-\Q)^+} + c \E{(\Q-D)^+} - s (\E{(\Q-D)^+} - \E{(\Q-D- W)^+}) \\
 &= b\E{(D-\Q)^+} + (c-s) \E{(\Q-D)^+} + s \E{(\Q-D- W)^+}.
% &= b(\E{(D-\Q)^+}-\Q) + (c-s) \E{(\Q-D)^+} + s \E{(\Q-D- W)^+}\\
 % &= -b \Q + (b + c-s) \E{(\Q-D)^+} + s \E{(\Q-D- W)^+} \\
 % &= -(p-c) \Q + (p-s) \E{(\Q-D)^+} + s \E{(\Q-D- W)^+}. \\
\end{align*}
\end{solution}
\end{exercise}

\begin{exercise}[Continuation]
What extra information do you need to compute $L(\Q)$ for the case with random salvage? How should this information be used to compute the optimal order level?
\begin{solution}
It can be done following the same steps we have taken in approaching the original newsvendor problem. The only difference is that now we should compute the term $\E{(\Q-D-W)^+}$. 
To compute this expectation, we also need the demand distributions for the left-over  products, besides the regular demand. Let $f(x)$ denote the pmf of the regular demand, i.e. $f(x)=\P{D=x}$. Assuming that the demand for left-over items is independent of the regular demand, let $g(y)$ denote its pmf, i.e. $g(y)=\P{W=y}$. Then
\begin{align*}
\E{(\Q-D-W)^+} & = \sum_x \sum_y (\Q-x-y)^+ f(x) g(y).
\end{align*}
The computation is trivial (do it for a simple case) and it can easily be done in spreadsheet applications.
\end{solution}
\end{exercise}


\subsection{Service Levels}

We have so far used a cost-based approach towards demand satisfaction, i.e., we model the cost of loss with the parameter $b$ per lost sales. Another relevant aspect  is quantified by the concept \recall{service level}. 
We say that the \recall{$\boldsymbol \alpha$-service level} is satisfied if the probability that all demand in a period is met from on-hand stock (i.e., no stock-out occurs) is larger than the threshold $\alpha$.  The \recall{$\boldsymbol{\beta}$-service level} is the fraction of demand satisfied from on-hand stock is larger than~$\beta$. 

So, how does it work when dealing with service levels? We choose a type of service level and  a critical level which are (we think) acceptable for our customers, or for the market in which we operate. Then we need to find a $\Q$ sufficiently large such that this level is met. Of course, $\Q$ should not be excessive as this leads to high costs. Thus, once again, the problem is to find a reasonable $\Q$. The formulas and exercises provide further insight into these concepts.

Let us start with the definitions. For the $\alpha$ service level, $\Q$ must be such  that
\begin{equation}\label{eq:26}
  F(\Q) = \P{D\leq \Q} \geq \alpha,
\end{equation}
while for the  $\beta$ service level we require $\Q$ to be  such that
\begin{align}\label{eq:25}
\frac{\E{\min\{\Q, D\}}}{\E{D}} \geq \beta.
\end{align}
Observe that the $\beta$ service level is a bit harder to compute than the $\alpha$ service level.

\begin{exercise}
Explain these formulas.
\begin{solution}
The $\alpha$-service level constraint is simply the probability of not stocking out. We stock-out if demand $D$ exceeds the order level $\Q$. This occurs with frequency $\P{D> \Q}$. Hence, the probability of not stocking out is $1-\P{D>\Q} = \P{D\leq \Q}$. 

Recall that $F(x) = \P{D\leq x}$ is the probability distribution of $D$. 

The $\beta$-service level is the ratio of expected demand satisfied to expected demand. Recall that the expected demand met is $\E{\min\{\Q, D\}}$ and the expected demand is $\E{D}$. 
\end{solution}
\end{exercise}

\begin{exercise}
For the $\beta$ service level we need to be able to compute  $\E{\min\{D,\Q\}}$. Show that
\begin{equation*}
  \E{\min\{D,\Q\}} = \sum_{i=0}^\Q i\/ f(i) + \Q\/\P{D> \Q}.
\end{equation*}
With this its is relatively easy to compute~\eqref{eq:25}. 
  \begin{solution}
\begin{align*}
  \E{\min\{D,\Q\}} 
&= \sum_{i=0}^\infty \min(i,\Q)f(i) = \sum_{i=0}^\Q i f(i) + \sum_{i=\Q+1}^\infty \Q f(i) \\
&= \sum_{i=0}^\infty \min(i,\Q)f(i) = \sum_{i=0}^\Q i f(i) + \Q \sum_{i=\Q+1}^\infty f(i).
%&=.\sum_{i=0}^\Q i f(i) + \Q \sum_{i=\Q+1}^\infty f(i)
\end{align*}
Observing that $\sum_{i=\Q+1}^\infty f(i)=\P{D\geq \Q+1}$,  we can simplify the above to
\begin{equation*}
  \E{\min\{D,\Q\}} = \sum_{i=0}^\Q i\/ f(i) + \Q\/\P{D\geq \Q+1}.
\end{equation*}
  \end{solution}
\end{exercise}


\begin{exercise}
To see how to apply the above, suppose that the demand has pmf
\begin{align*}
 f(0)&=0.1, &f(1)&=0.05, &f(2)&=0.2, \\
f(3) &= 0.3 & f(4) &= 0.15 & f(5)=& 0.1, &f(6)&=0.1.
\end{align*}
What $\Q$ do you need to satisfy an $\alpha$ service level of 80\%; what for a $\beta$-level of $90\%$?
\begin{solution}
First we need the distribution function $F$. From the above
$F(6)=1$, $F(5)=1-f(6) = 0.9$, $F(4)=F(5)-f(5) = 0.8$. Thus, from~\eqref{eq:26}, we see that by taking $\Q=4$, we have an $\alpha$-service level of 80\%.

For the $\beta$, we need $\E D$ and $\E{\min\{\Q, D\}}$. As this is a bit of work, we write a computer program to carry out the work. We start with computing the basic things
\begin{pyconsole} [news-service]
import numpy as np

f = np.array([0.1, 0.05, 0.2, 0.3, 0.15, 0.1, 0.1])
F = f.cumsum()
F
G = 1 - F
G
ED = sum(i*p for i, p in enumerate(f))
ED
\end{pyconsole}

Here is the function to compute the $\beta$-service level.
\begin{pyconsole}[news-service]
def beta(S):
    res = sum(i*p for i, p in enumerate(f) if i <= S)
    res += S*G[S]
    res /= ED
    return res
    
\end{pyconsole}
And the results.
\begin{pyconsole}[news-service]
for S in range(len(f)):
    print(S, beta(S))
    
\end{pyconsole}
To meet a $\beta$ service level of $0.9$ we need  $\Q=5$, which is nearly large enough, or, if we insist $\Q=6$. 
\end{solution}
\end{exercise}

\begin{exercise}
To gain some further intuition:  what happens to the service levels if $\Q$ increases?
  \begin{solution}
Notice that both service level measures are increasing in the order level. That is, the more we order the higher the service level. In detail, for the $\alpha$ level,
\begin{align*}
  \P{D\leq \Q+1} = \P{D\leq \Q} + \P{D=\Q+1} > \P{D \leq \Q}.
\end{align*}
Thus, if $\P{D\leq \Q} > \alpha$, then $\P{D\leq \Q+1}$ certainly is. For the $\beta$ level, observe that $\E{\min\{\Q+1, D\}} \geq \E{\min\{\Q, D\}}$. 
  \end{solution}
\end{exercise}

\begin{exercise}
Finally, to understand how the $\alpha$ and $\beta$ service measures compare against each other, consider a case with $f(100)=\P{D=100}=1$ and $\Q=99$. Conclude that the $\beta$ service level is more useful.
\begin{solution}
Despite these measures serve for somewhat similar purposes, they can be very different than each other. For instance, consider the case that $D=100$ always, and we order $\Q=99$ units. 
In this case, 
\begin{align*}
F(99) = \P{D\leq \Q} = 0.
\end{align*}
Thus, our performance with respect to the $\alpha$ service level is terrible.
On the other hand, we know that we will satisfy exactly 99 units of demand if we order 99 units. Therefore, the stock-out  quantity is just 1 unit. Thus, our fill rate will be 
\begin{align*}
\frac{\E{\min\{\Q,D\}}}{\E{D}} = \frac{99}{100} = 0.99.
\end{align*}
The performance with respect to the $\beta$ service level is excellent.
\end{solution}
\end{exercise}

At this point we have discussed the most important aspects of the single-period newsvendor. We have cost and profit functions by which we compute the influence of the order level $\Q$ on both of these, and we have functions to assess the service levels. In the next two sections we show how to compute all these functions for two specific, but for practice reasonable, demand distributions. 


\subsection{Newsvendor problem with normal demand}

As in many cases the demand distribution of $D$ can be fairly well approximated by a normal distribution with mean $\mu$ equal to the average demand $\E D$ and $\sigma^2$ equal to the demand variance $\V D$. When the normal approximation holds, the computations of the $L(\Q)$ and the service levels can be considerably simplified. Here we discuss how to go about in this situation. 


We first concentrate on computing $L(\Q)$ and $\Q^*$ for normally distributed demand.  Then, omitting the math, 
\begin{equation*}
L(\Q)  = h(\Q-\mu) + (h+b) \sigma F_{\text{loss}}(z),
%& = h \ex (\Q-D)^+ + b \ex (\Q-D)^- \\
\end{equation*}
where 
%$$ and $F_{\text{loss}}$ is the 'standard normal loss function'. 
%The standard normal loss function is defined as 
\begin{align*}
z&=\frac{\Q-\mu}{\sigma} & F_{\text{loss}}(z) &= \phi(z)-z(1-\Phi(z))
\end{align*}
with $\phi(z)$ and $\Phi(z)$ are the density and distribution function, respectively, of a standard normally distributed random variable with $\mu=0$ and $\sigma=1$.\footnote{These functions are accessible in spreadsheet applications. For instance, in Excel we have 
\begin{align*}
\phi(z) &=\mathtt{NORMDIST(z,0,1,FALSE)}
&
\Phi(z) &=\mathtt{NORMSDIST(z)}.
\end{align*}
With this, we can compute the 'standard normal loss function as
\begin{align*}
F_{\text{loss}}(z) = \mathtt{=NORMDIST(z,0,1,FALSE)-z*(1-NORMSDIST(z))}.
\end{align*}
}


\begin{exercise}\label{ex:nw_stoc_norm}
Let $D$ be normally distributed with mean 20 and standard deviation 5, $h=1$ and $b=10$; and plot $L(\Q)$ for different values of $\Q=1,\ldots,40$.


\begin{solution}
See the figure.

\begin{pycode}[news]
h = 1
b = 10
mu = 20
sigma = 5 
D = norm(loc=mu, scale=sigma) 

def L(q):
    term1 = h*quad(lambda x: (q-x)*D.pdf(x), 0, q)[0]
    term2 = b*quad(lambda x: (x-q)*D.pdf(x), q, np.inf)[0]
    return term1 + term2

X = np.arange(0, 40, 1)

Lnorm = []
for q in X:
    Lnorm.append(L(q))

plt.figure(figsize=(5, 4))
plt.plot(X, Lnorm, label="$L(S)$, normal")
plt.xlabel("$S$")
plt.ylabel("Cost")
plt.legend()
filename = "figures/Lnorm.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\begin{center}
\includegraphics{figures/Lnorm.pdf}
\end{center}

\end{solution}
\end{exercise}


\begin{exercise}[Continuation]
Compare  the graphs obtained in Exercises~\ref{ex:nw_det} and~\ref{ex:nw_stoc_norm}. 
Specifically, observe and discuss:
\begin{enumerate}
\item Why is the  cost for the stochastic system larger?
\item Why are the costs around $\Q=0$ and $\Q=40$ nearly the same? 
\item Why is the optimal order level in the stochastic case a bit larger?
\end{enumerate}
% Note that the deterministic problem considered in Exercise~\ref{ex:nw_det} can be perceived as a stochastic problem with normally distributed demand with mean 20 and 0 standard deviation.
\begin{solution}
Here is the graph.

\begin{pycode}[news]
h = 1
b = 10

def L(q, D):
    term1 = h*quad(lambda x: (q-x)*D.pdf(x), 0, q)[0]
    term2 = b*quad(lambda x: (x-q)*D.pdf(x), q, np.inf)[0]
    return term1 + term2

X = np.arange(0, 40, 1)

D = 20
Ldet = []
for q in X:
    Ldet.append(h*max(q-D, 0) + b*max(D-q, 0))

mu = 20
sigma = 5 
D = norm(loc=mu, scale=sigma) 
Lnorm = []
for q in X:
    Lnorm.append(L(q, D))

plt.figure(figsize=(5, 4))
plt.plot(X, Lnorm, label="$L(S)$, normal")
plt.plot(X, Ldet, label="$L(S)$, deterministic")
plt.xlabel("$S$")
plt.ylabel("Cost")
plt.legend()
filename = "figures/Lnorm_det.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\begin{center}
\includegraphics{figures/Lnorm_det.pdf}
\end{center}

\begin{enumerate}
\item The stochastic cost is always larger than the deterministic one. this is due to the fact that there is always a non-zero probability of overage and shortage in the stochastic case. 
\item For very small and very large values of order level cost figures coincide. This can be explained as follows. On the one hand, if order level is very large then, most surely, no demand will be lost. Therefore, the expected total cost will be nearly overage cost times the order level minus the expected demand, i.e. $\approx h(\Q-\E{D})$. On the other hand, if the order level is very small then all demand will be lost. Therefore, the expected total cost will be nearly equal to shortage cost times the expected demand, i.e. $b \E{D}$. 
% That's why the we have $L(0)\approx 10\cdot20=200$. This is the very same cost that would realize if demand was exactly 20 units and the order level was 0.
\item It is optimal to order 20 units in the deterministic case, whereas it is a bit higher in the stochastic case. This can be attributed to the demand uncertainty and shortages being more expensive as compared to overages. 
\end{enumerate}

\end{solution}
\end{exercise}




\begin{exercise}[Continuation]
Plot $L(\Q)$ three times, for $\sigma=1$, $\sigma=5$ and $\sigma=10$, respectively. What do you observe?
\begin{solution}
In the figure below we observe that increasing standard deviation leads to further deviations from the deterministic case and larger optimal order quantities. 

\begin{pycode}[news]
h = 1
b = 10
X = np.arange(0, 40, 1)

D = 20
Ldet = []
for q in X:
    Ldet.append(h*max(q-D, 0) + b*max(D-q, 0))

def L(q, D):
    term1 = h*quad(lambda x: (q-x)*D.pdf(x), 0, q)[0]
    term2 = b*quad(lambda x: (x-q)*D.pdf(x), q, np.inf)[0]
    return term1 + term2


mu = 20
sigma = 1
D = norm(loc=mu, scale=sigma) 
Lnorm1 = []
for q in X:
    Lnorm1.append(L(q, D))

mu = 20
sigma = 5 
D = norm(loc=mu, scale=sigma) 
Lnorm5 = []
for q in X:
    Lnorm5.append(L(q, D))

mu = 20
sigma = 10
D = norm(loc=mu, scale=sigma) 
Lnorm10 = []
for q in X:
    Lnorm10.append(L(q, D))


plt.figure(figsize=(5, 4))
plt.plot(X, Ldet, label="$L(S), \sigma=0$")
plt.plot(X, Lnorm1, label="$L(S), \sigma=1$")
plt.plot(X, Lnorm5, label="$L(S), \sigma=5$")
plt.plot(X, Lnorm10, label="$L(S), \sigma=10$")
plt.xlabel("$S$")
plt.ylabel("Cost")
plt.legend()
filename = "figures/Lnorm_sigma.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\begin{center}
\includegraphics{figures/Lnorm_sigma.pdf}
\end{center}


\end{solution}
\end{exercise}


For normally distributed demand the critical fraction condition~\eqref{eq:255} takes a particularly simple form. Again, omitting the math,
\begin{equation}\label{eq:412}
\Q^* = \mu + \sigma \Phi^{-1}\left(\frac b{b+h}\right) 
\end{equation}
where $\Phi^{-1}$ is the inverse of the standard normal distribution.\footnote{In  spreadsheet applications,  for instance Excel, this is 
\begin{align*}
\Phi^{-1}(\beta)=\mathtt{=NORMSINV(b/(b+h))}.
\end{align*}
}
%if the inverse distribution function of the demand exists. 
Thus, besides plotting $L(\Q)$ for many different values of $\Q$ and searching for its minimizer $\Q^*$, we have a simple formula to find $\Q^*$. This is actually another reason to model demand as normally distribution: the computation of $\Q^*$ is so easy.



\begin{exercise}[Continuation with $\sigma=5$]
%Let $D$ be normally distributed with mean 20 and standard deviation 5, $h=1$ and $b=10$. 
What is the optimal order level? Verify your result by comparing it against the graph you obtained in Exercise~\ref{ex:nw_stoc_norm}. 



\begin{solution}
$b/(b+h)=10/11$. 
\begin{align*}
\Q^* 
& = \mu + \sigma \Phi^{-1}(b/(b+h)) \\
& = 20 + 5\cdot \Phi^{-1}(10/11) = 20 + 5\cdot \Phi^{-1}(1.3352) = 26.676.
\end{align*}
\end{solution}
\end{exercise}


\begin{exercise}[Continuation]
Plot the $\alpha$- and $\beta$-service levels for different values of $\Q$.
\begin{solution}
See the figure.\nvf{todo, make python}\nvf{Explain how to read this.}

\begin{pycode}[news]
S_range = np.arange(0, 40, 1)
demand = norm(loc=20, scale=5)

# alpha level
alpha = demand.cdf(S_range)

# beta level 
beta = []
for S in S_range:
    beta.append(demand.expect(lambda x: min(x, S))/demand.mean())
    #res = quad(lambda x: min(x, q)*demand.pdf(x), 0, np.inf)[0]


plt.figure(figsize=(5, 4))
plt.plot(S_range, alpha, "o", markersize="2", label='$\\alpha$')
plt.plot(S_range, beta, "+", markersize="3", label='$\\beta$')
plt.xlabel("$\Q$")
plt.legend(loc="upper left")
#plt.show()
#quit()
filename = "figures/newsvendor_alpha.pdf"
plt.savefig(filename)
plt.close()
\end{pycode}

\begin{center}
\includegraphics{figures/newsvendor_alpha.pdf}
\end{center}
\end{solution}
\end{exercise}


The term \recall{safety stock} is the extra on-hand stock to mitigate the costs due to stock-outs. 

\begin{exercise}
Explain that the term $\sigma \Phi^{-1}(b/(b+h))$ in \eqref{eq:412} corresponds to the  safety stock.
\begin{solution}
In $\Q^* = \mu + \sigma \Phi^{-1}(b/(b+h))$, the mean $\mu$ is required to cover the mean demand. The second $\sigma \Phi^{-1}(b/(b+h))$ stands for the safety stock, as it exactly is the extra stock, on the top of the anticipated demand $\mu$, to avoid stock outs.
\end{solution}
\end{exercise}

\begin{exercise}
How do $\sigma$ and $b$ affect the critical fraction?
\begin{solution}
We first observe that $\sigma \Phi^{-1}(b/(b+h))$ is increasing in the standard deviation $\sigma$ of the demand.  Second, if $b/(b+h)$ increases, $\Phi^{-1}(b/(b+h))$ also increases. Thus, we see that $b/(b+h)$ increases if the stock-out costs $b$ increase. Thus, if $b$ increases, the safety stock also increases.
\end{solution}
\end{exercise}

\begin{exercise}
Can safety stock be negative?


\begin{solution}
Yes. If the unit overage cost is higher than the unit shortage cost, then it could make sense to order less than the mean demand. For instance, in case of normally distributed demands, if we had $h>b$ and therefore $b/(b+h)<0.5$, then $\Phi^{-1}(b/(b+h))<0$. This would, in turn, lead to a negative safety stock. 
\end{solution}
\end{exercise}

\begin{exercise} Suppose you have to manufacture Christmas lights\footnote{The exercise is adapted from \cite{hopp08:_factor_physic}} for the Christmas period. Demand that cannot be met from on-hand stock is lost, while unsold items are salvaged. Lights sell at a price  $p=10$, the production cost $c=5$, and the salvage value is $2.5$. Data from the past show that it is reasonable to model demand as normally distributed with $\mu=10 000$ and $\sigma=2 000$. What is the optimal produce-up-to level $S^*$? What happens if $\sigma = 5 000$?

\begin{solution}
Here are the numbers.
\begin{pyconsole}[christmas]
from scipy.stats import norm
h = 5 - 2.5  
b = 10 - 5
mu = 10000
sigma = 2000
D = norm(loc=mu, scale=sigma) # demand
\end{pyconsole}

Now the computations.
\begin{pyconsole}[christmas]
critical_fractile = b/(h+b)
S_star = D.ppf(critical_fractile)
S_star
\end{pyconsole}

If $\sigma$ is quite big, we cannot use this demand model any more; the probability of negative demand is too high. For this reason we need, for instance, the demand model of Section~\ref{sec:newsv-probl-with}. 
\end{solution}
\end{exercise}

\begin{example}
Here is a final example on how to apply the newsvendor policy.  Suppose that you plan to sell Napoleons, tomorrow  just outside of the Duisenberg building.
  \begin{center}
   \includegraphics[scale = 1.0]{figures/mille-feuille}
  \end{center}
The question is how  many  Napoleons  you need to order and how much money  you expect to make. We emphatically remark that our analysis below  of this problem extends way beyond napoleons; it applies equally well to fashion, perishable food, and so on.
  

Lets first make some guesses about the prices. A selling price of $p=0.75$ is reasonable; its the same as in a supermarkt. For the buying price, take $c = 0.25$, but this just a guess, in fact, we don't know. However, we do know that supermarkets make quite a big profit on anything they sell, so taking $c=p/3$ seems an ok guess. Next, for the salvage value, we take $s=0$; we don't plan to eat more than one or two left overs. As a consequence, $h = 0.25$, and $b = 0.5$. 

To estimate  the demand we need some more work. The problem is that, for napoleons, we don't have yesterday's demand (we have never sold napoleons so we don't have this data). Can we then use demand data of similar products?  No, we  never tried to sell anything similar to napoleons. Can we ask our sales force?  No, because  we don't have a sales force.  As a last resort, then, we decide to make an educated guess. For this, we use the increadibly powerful tool of \recall{powers of ten method}\footnote{If there is anything you have to remember from this set of notes, it is this trick! Its impossible to overestimate how useful this method is.}. Under the above pricing model, we expect to sell more 1 napoleon and also more than 10. A hundred  is possible, thousand seems too much (If there are 5000 student on a day in the Duisenberg, one out of five needs to buy a napoleon; this seems too much.) So, we take  $\mu=100$ as an estimate for the mean. Next, since we are not sure about $\mu$, lets assume $\sigma=30$. 

Note that, after having computed the optimal order level $\Q^*$ for these parameters, we can always change some of the parameters if $\Q^*$ seems wrong. 

\begin{pycode}[news]
#from scipy.stats import norm
from scipy.integrate import quad
p = 0.75
c = 0.25
s =0
critical_fractile = (p - c)/(p -s)
D = norm(loc=100, scale=30)
S_star = D.ppf(critical_fractile)   

E_min = quad(lambda x: min(x, S_star)*D.pdf(x), 0, np.inf)[0]
E_min
P = -c * S_star + 0.75*E_min
\end{pycode}

Using the critical fraction formula with $b/(b+h) = 0.5/0.75 = 2/3$, 
\begin{equation*}
  \Q^* = 100 + 30 * \Phi^{-1}(2/3) = 100 + 30 * 0.43 = 112.
\end{equation*}
This appears reasonable.  Next, we compute the profit
  \begin{align*}
P(\Q) 
&= (s-c)\Q + (p-s)\E{\min\{D, \Q\}} \\
&= -0.25 \Q + 0.75 \E{\min\{D, \Q\}} \\
&=\py[news]{"{0:.2f}".format(P)}.
  \end{align*}
Hmm, less than 50 Euros for a day's work, plus the risk. Obtaining a master degree brings in more money eventually, and also in a safer way. 


\begin{exercise}
   Summarize the steps  we took to analyze the napoleon
   case and to  obtain some reasonable estimates on profit. 
   \begin{solution}
  \begin{itemize}
  \item Make reasonable guesses about buying, selling and salvage price.
  \item Estimate a demand distribution based on the sales price
  \item Make plots of the profit $Z$ as a function of $\Q$, the demand
    distribution, and the sales price.
  \item Choose a $\Q$ that makes sense. The existence of an optimal $\Q$
    is a \emph{delusion}.
  \end{itemize}

Be aware that sales force may predict too high demand. They get incentives to sell much, but they are not penalized for overages!
   \end{solution}
\end{exercise}
\end{example}


\subsection{Newsvendor problem with log-normal demand (\faRocket)}
\label{sec:newsv-probl-with}

\begin{exercise}
Suppose measurements show that the demand has mean $\mu=100$ and standard deviation $\sigma=50$. Why is it a bad idea to use the normal distribution to model the demand?
\begin{solution}
It is well-known that normal distribution is not appropriate for modeling demands if standard deviation is large. That is because it then assigns a significant probability to negative demands. For instance, the probability of having a demand less than or equal to zero is around 16\% if it is normally distributed with the same mean and standard deviation. As a rule of thumb; it would make sense to avoid normal distribution if standard deviation is larger than one third of the demand. 
\end{solution}
\end{exercise}

To repair this problem with the normal distribution, the log-normal distribution is an interesting alternative.  Its domain is restricted to the positive numbers, hence demand cannot be negative,  while it still possesses many (but not all) practical properties of the normal distribution. Specifically, when a random variable $D$ is normally distributed with mean $\mu$ and standard deviation $\sigma$, then $e^D$ is log-normally distributed with mean $\upsilon$ and standard deviation $\tau$ where 
\begin{align*}
\upsilon = \ln \mu - \ln \sqrt{1+(\sigma/\mu)^2} \quad \text{and} \quad \tau = \sqrt{\ln(1+(\sigma/\mu)^2)}
\end{align*}
The log-normal distribution is easily accessible in spreadsheet applications\footnote{For instance, in Excel it's probability distribution function can be obtained by
\begin{equation*}
F(x)=\mathtt{LOGNORMDIST(x,\upsilon,\tau)} 
\end{equation*}
}.


For log-normal distributed demand it can be seen that the minimal costs are attained at
\begin{align*}
%L(\Q) & = h(\Q-\mu) + (h+b) (\mu\Phi(\tau-z) - \Q\Phi(-z)) \\
\Q^* & =e^{\upsilon + \tau \Phi^{-1}(b/(b+h))},
\end{align*}
where, $z=(\Q-\mu)/\sigma$ and $\Phi$ is the standard normal distribution function.


\begin{exercise}
Plot and compare the probability distribution functions of the normal and log-normal distributions for $\mu=20$ and  for different values of standard deviation $1, 5, 10, 20$.
\begin{solution}
See the figures below. We observe that the normal distribution function has a positive probability at zero. This is not the case for log-normal distributions. It is also possible to see that normal and log-normal distributions look alike if standard deviation is small.

\begin{pycode}[news]
from scipy.stats import lognorm
x = np.linspace(0, 40, 100)

# check tijms for the conversion

def plot(mu, sigma):
    s = np.sqrt(np.log(1+sigma**2/mu**2))
    scale = mu/(1+sigma**2/mu**2)


    plt.figure(figsize=(2.5, 3.5))
    plt.plot(x, norm.cdf(x, loc=mu, scale=sigma), label="Norm") 
    plt.plot(x, lognorm.cdf(x, s=s, scale=scale), '--', label="Log")
    plt.xlabel("$x$")
    #plt.ylabel("pdf")
    plt.title("$\mu={}, \sigma={}$".format(mu, sigma))
    plt.legend()
    filename = "figures/lognorm_{}_{}.pdf".format(mu, sigma)
    plt.savefig(filename)
    plt.clf()

plot(mu=20, sigma=20)
plot(mu=20, sigma=10)
plot(mu=20, sigma=5)
plot(mu=20, sigma=1)

plt.close()
\end{pycode}

\begin{center}
  \begin{tabular}[h]{cc}
\includegraphics{figures/lognorm_20_20.pdf} &
\includegraphics{figures/lognorm_20_10.pdf} \\
\includegraphics{figures/lognorm_20_5.pdf} &
\includegraphics{figures/lognorm_20_1.pdf} \\
  \end{tabular}
\end{center}


\end{solution}
\end{exercise}



\subsection{A newsvendor model with two stages}

Let us consider a case where we have a two-period planning horizon rather than the one period for the original newsvendor problem. As a concrete example we take a bread inventory at a supermarket with two moments to bake bread: one before the shop opens and a second at noon. Thus, there are two periods, the morning and the afternoon, and bread that is not sold in the morning acts as a starting inventory for the afternoon. Thus, rather than having just one ordering decision, i.e., the order-up-to level for bread for the entire day, we have an extra order moment to update the inventory level.


In the analysis to follow, we assume that we are not allowed to backorder demands. That is, demands that are not satisfied in the morning are lost. Nevertheless, our derivations can easily be extended to the case where backorders are allowed.  Moreover, we assume that items at the end of the period will not be salvaged but passed on to the second period.

For convenience, we use the same notation that we used for the single-period newsvendor model. However, we add a period index to the buying and selling prices as well as the demand distribution, e.g.,  $c_n$, $p_{n}$, $f_n(\cdot)$ where $n\in\{1,2\}$), as these can be different in the first and the second period. 

We work in steps, one step per exercise, to the final solution, and we reason `backwards', that is we first analyze the optimal decision structure for the last period (the afternoon), and then consider what to do for the first period (the morning).

\nvf{make simulation}

\begin{exercise} Explain that 
\begin{align*}
\Q^*_2 = \min\left\{\Q_2 : F_2(\Q_2)\geq \frac{b_2}{b_2+h_2}\right\}.
\end{align*}
is the optimal inventory level $\Q_2^*$ to  start the second period.
\begin{solution}
This follows right away from~\eqref{eq:255} with the cost parameters for the second period. Note that  $F_2$ is the distribution function of the demand for the second period.
\end{solution}
\end{exercise}


\begin{exercise}
Explain that the  expected profit for the second period if you order $\Q_2$ items is
\begin{align}\label{eq:28}
P_2(\Q_2) = b_2 \Q_2 - (b_2+h_2)\E{(\Q_2-D_2)^+}.
%-c_{2} \Q_2+ p_{2}\E{\min\{\Q_2,D_2\}} + s_{2}\E{(\Q_2-D_2)^+}.
\end{align}
\begin{solution}
Just specialize the buying cost $c$ to $c_2$ and so on in~\eqref{eq:27}.
\end{solution}
\end{exercise}

Suppose henceforth that $x$ items are left from the first period, hence can be used as starting inventory for the second period.
  
\begin{exercise}
Assume we order up to $\Q_2$,  show that the profit for the second period is given by
$c_2 x + P_2(\Q_2)$.
\begin{solution}
Rather than having to buy all $\Q_2$ items, we don't have to buy the $x$ items. This saves a cost $c_2 x$. 
\end{solution}
\end{exercise}

\begin{exercise}
Explain that it is optimal to order up to $\Q_2^*$ when $x<\Q_2^*$, but when $x\geq 
\Q_2^*$ it is best not to order at all. Thus, the optimal order level is $\Q_2^* = (S_2^* - x)^+$.  
\begin{solution}
If $x<\Q_2^*$, we order up to level $\Q_2^*$ because $\Q_2^*$ is the optimal amount to start the period. When $x\geq \Q_2^*$, it is better not to order. 
\end{solution}
\end{exercise}

\begin{exercise}
Given the starting inventory level $x$, show that optimal profit for the second period is
\begin{align}\label{eq:24}
V_2(x) & = c_2x + \max_{\Q_2\geq x} \left\{P_2(\Q_2)\right\} \notag \\
&= c_2x +
  \begin{cases}
    P_2(x), &\text{ if } x\geq \Q_2^*, \\
    P_2(S_2^*), &\text{ if } x<\Q_2^*.
  \end{cases}
\end{align}
\begin{solution} Observe that
\begin{align*}
V_2(x) 
&:=\max_{\Q_2\geq x} \left\{P_2(x,\Q_2)\right\} 
= \max_{\Q_2\geq x} \left\{c_2x + P_2(\Q_2)\right\} \\
& = c_2x + \max_{\Q_2\geq x} \left\{P_2(\Q_2)\right\}.
\end{align*}
Next, with the previous exercise, if $x\geq \Q_2^*$ we don't order, and the second period starts at level $x$. If, on the other hand, $x<\Q_2^*$, it is optimal to place an order such that the second period starts at level $\Q_2^*$.
\end{solution}
\end{exercise}

\begin{exercise}
As a check, what is $V_2(0)$? 
  \begin{solution}
    Assuming that $\Q_2^*>0$, we get $V_2(0) = 0 + P_2(\Q_2^*)$, i.e., the optimal profit for the second period without any starting inventory. 
  \end{solution}
\end{exercise}


\begin{exercise}
It appears that $V_2(x)$ is increasing in $x$, that is, the more we have at the beginning of the period the better. Does it make sense? Could there be a case where it is not increasing? Illustrate through an example.
\begin{solution}
Yes. First, although we have more inventory, we do not actually 'pay' for those. Therefore, there are a lot of cost savings, as  captured in the term $cx$. Second, as there is a salvage value, we can always sell left-overs (which we did not pay for in the first place). 

There can indeed be cases where having more is not better. For instance, an example appears in cases with negative salvage value
\end{solution}
\end{exercise}

The two exercises form a toy example to show how to apply the above. Let the demand $D_2$ have  pmf 
$f_2(0)=1/4, f_2(1)=1/5, f_2(2)=11/20$, and let $c_2=3$, $p_2=4$, and $s_2=1$. 

\begin{exercise}
Compute $P_2$ for $\Q_2$ is $0, 1, 2,$ and $3$. Show that the optimal starting level $\Q^*_2 = 1$ and $P_2(\Q_2^*) = 1/4$.
\begin{solution}
The critical fraction is 
\begin{equation*}
\frac{b_2}{b_2+h_2} = \frac{1}{1+2} = \frac 1 3,
\end{equation*}
where $b_2 =p_2-c_2 = 4-3=1$ and $h_2 =c_2 - s_2 = 3-1=2$. 
As $F_2(0)=f_2(0)=1/4$, and $F_2(1)=F_2(0) + f_2(1) = 1/4 + 1/5 = 9/20$, and $F_2(2)=1$ the result follows.

Next, 
\begin{align*}
  P_2(\Q_2^*) 
&= b_2 \Q_2^* - (b_2+h_2)\E{(\Q_2^*-D_2)^+} \\
&= 1\cdot 1 - (1+2)\E{(1-D_2)^+} & \Q_2^* = 1\\
&=1 - 3 \sum_{i=0}^2 (1-i)^+ f_2(i) \\
&=1 - 3 ((1-0)^+ f_2(0) + (1-1)^+ f_2(1) +(1-2)^+ f_2(2) \\
&=1 - 3 (1\cdot 1/4 + 0 + 0 ) \\
&=  1 - \frac 3 4 = \frac 1 4.
\end{align*}
Likewise 
\begin{align*}
  P_2(2) 
&= 1\cdot 2 - (1+2)\E{(2-D_2)^+} \\
&= 2 - 3 (2f_2(0) + 1 f_2(1) + 0 f_2(2))\\
&= 2 - 3 (\frac{2}{4} + \frac 1 5)\\
&= 2 - \frac{21}{10} = -\frac 1{10}.
\end{align*}

Lets check it with the computer.
\begin{pyconsole}[news-two]
f2 = [1/4, 1/5, 11/20]
c2, p2, s2 = 3, 4, 1
b2, h2 = p2-c2, c2-s2

def P(S, f, b, h):
    res = b*S
    res -= (b+h)*sum(max(S-i,0)*fi for i, fi in enumerate(f))
    return res
    
for S2 in range(0, 4):
    print("{}: {}".format(S2, P(S2, f2, b2, h2)))

\end{pyconsole}
We get the same results for what we computed by hand.

\end{solution}
\end{exercise}

\begin{exercise}
Now we consider three cases: $x$ can be either 0, 1, and 2. For which $x$ do we place an order, and what are $V_2(0), V_2(1)$, and $V_2(2)$? 
\begin{solution}
We use~\eqref{eq:24}. 
\begin{align*}
  V_2(0) &= P_2(\Q_2^*) = \frac 1 4,\\
  V_2(1) &= 3\cdot 1 + P_2(\Q_2^*) = 3 + \frac 1 4 = \frac{13}{4}\\
  V_2(2) &= 3\cdot 2 + P_2(2) = 6 - \frac 1{10} = \frac{59}{10},
\end{align*}

\begin{pyconsole}[news-two]
def V2(x):
    # use that the S2^* = 1
    S2star = 1
    res = c2*x
    if x >= S2star:
        res += P(x, f2, b2, h2)
    else:
        res += P(S2star, f2, b2, h2)
    return res

for S2 in range(0, 4):
    print("{}: {}".format(S2, V2(S2)))

\end{pyconsole}

We only place an order when $x=0$. 
\end{solution}
\end{exercise}

We now consider the joint problem of determining the first and second periods of the two-period newsvendor model.

\begin{exercise}
If we order up to $\Q_1$ for the first period, realize that $\E{(\Q_1-D_1)^+}$ are the expected number of items salvaged. Explain now that, assuming that the optimal decision is taking for the second period, the total profit $P(\Q_1)$ becomes
\begin{align*}
  P(\Q_1) 
&= P_1(\Q_1) - s_1 \E{(\Q_1 - D_1)^+} + \E{V_2(\Q_1-D_1)^+},
\end{align*}
where $P_1(\Q_1)$ is the profit of the first period when we order $\Q_1$. 
\begin{solution}
For the first period we make a profit $P_1(\Q_1)$. Now the expected number remaining at the end if $\E{(\Q_1 - D_1)^+}$. Rather than salvaging these at a price $s_1$ per unit, we shift them to the next period. Thus, we need to subtract the salvage profit from these items from the first period, and use this number as the starting number of items for the second period. 
\end{solution}
\end{exercise}



Suppose that the demand $D_1$ for the first period has pmf $f_1(0)=1/2, f_1(1)=1/3, f_2(2) = 1/6$, 
and the demand $D_2$ is as above. Take $c_{1}=3$, $p_{1}=5$, $s_1=2$. 

\begin{exercise}
Compute the total profit $P$ for $\Q_1=1, 2,$ and $3$. Implement the computations   in a spreadsheet or some program to save you some work, and help checking.
\begin{solution}
Let us start with computing the profit for the first period. From, \eqref{eq:28}, From the formulas we see that we need to  $\E{(\Q_1-D_1)^+}$ twice. Thus, lets first compute this separately.
\begin{align*}
  \E{(1-D_1)^+} &= (1-0)f_1(0) = \frac 1 2, \\
  \E{(2-D_1)^+} &= (2-0)f_1(0) + (2-1)f_1(1) = 1 + \frac 1 3 = \frac 4 3, \\
  \E{(3-D_1)^+} &= (3-0)f_1(0) + (3-1)f_1(1) -(3-2) f_1(2) = \frac 3 2 + \frac 2 3 +  \frac 1 6 = \frac 7 3.
\end{align*}


\begin{pyconsole}[news-two]
f1 = [1/2, 1/3, 1/6]
c1, p1, s1 = 3, 5, 2
b1, h1 = p1-c1, c1-s1


for S1 in range(0, 4):
    res = sum(max(S1-i, 0)*fi for i, fi in enumerate(f1))
    print("{}: {}".format(S1, res))

\end{pyconsole}
  

Now, as
\begin{align*}
  b_1 &= p_1 - c_1 = 5-3 = 2, & h_1 &= c_1 -s_1 = 3-2 = 1.
\end{align*}
we get 
\begin{align*}
P_1(\Q_1) 
&= b_1\Q_1 - (b_1+h_1)\E{(\Q_1 - D_1)^+} \\
&= 2\Q_1 - 3\E{(\Q_1 - D_1)^+} \\
P_1(0) &= 0, \\
P_1(1) &= 2 - 3\cdot \frac 1 2 = \frac 1 2, \\
P_1(2) &= 4 - 3\cdot \frac 4 3 = 0, \\
P_1(3) &= 6 - 3\cdot \frac 7 3 = -1, \\
\end{align*}

\begin{pyconsole}[news-two]
for S1 in range(0, 4):
    print("{}: {}".format(S1, P(S1, f1, b1, h1)))

\end{pyconsole}
We defined \texttt{P} above.
  
As a next step: 
\begin{align*}
\E{V_2((\Q_1-D_1)^+)} 
&= V_2((\Q_1 - 0)^+)f_1(0) + V_2((\Q_1 - 1)^+)f_1(1) + V_2((\Q_1 - 2)^+)f_1(2)\\
&= V_2(\Q_1)\cdot \frac 1 2 + V_2((\Q_1 - 1)^+)\cdot \frac 1 3 +  V_2(\Q_1 - 2)^+)\frac 1 6\\
\E{V_2((1-D_1)^+)} 
&= V_2(1)\cdot \frac 1 2 + V_2(0)\cdot \frac 1 3 +  V_2(0)\frac 1 6\\
&= \frac{13}{4}\cdot \frac 1 2 + \frac 1 4 \cdot \frac 1 3 +  \frac 1 4 \cdot \frac 1 6\\
&= \frac{13} 8 + \frac 3{12} = \frac{13}{8} + \frac{2}{8} \\
&= \frac{15}{8}.
\end{align*}

\begin{pyconsole}[news-two]
for S1 in range(0, 4):
    res = sum(V2(max(S1-i, 0))*fi for i, fi in enumerate(f1))
    print("{}: {}".format(S1, res))

\end{pyconsole}
  

Finally,  for the total profit, lets use the machine right away.
\begin{pyconsole}[news-two]
def P_tot(S1):
    res = P(S1, f1, b1, h1)
    res -= s1*sum(max(S1-i, 0)*fi for i, fi in enumerate(f1))
    res += sum(V2(max(S1-i, 0))*fi for i, fi in enumerate(f1))
    return res
    
for S1 in range(0, 4):
    print("{}: {}".format(S1, P_tot(S1)))

\end{pyconsole}
\end{solution}
\end{exercise}

\begin{exercise}[Continuation]
 What is the optimal order level $\Q_1^*$ in the first period if we are to take the 'best' ordering decision in the second period?  
\begin{solution}
We need to find $\max_{\Q_1} P(\Q_1)$. To that end, we can try different $\Q_1$ values and pick the largest.  We did this in the previous exercise. It is optimal to set $\Q_1^*=1$. 
\end{solution}
\end{exercise}


\begin{exercise}
Repeat the previous exercise but this time assume that the demand in the first and the second periods with pmf $f_1 = f_2 = f$, and $f(0)=f(1)=\ldots=f(9)=\frac{1}{10}$. 
Compute $P$ for various values of $\Q_1$, put them in a graph, and analyze and interpret this graph.

\begin{solution}

The figure shows that $Z_1(\Q_1)$ is concave on $\Q_1$. Moreover, the profit is pretty sensitive to the order level $\Q_1$. One reason for the sensitivity might be that we took $f(i)=1/11$, i.e., the demand is uniformly distributed. It would be interesting to consider a demand distribution with a single peak, like the normal distribution, and then see whether the profit is less sensitive to order size $\Q_1$.
\end{solution}
\end{exercise}

As an interesting extension, suppose that the newsvendor has to pay a fixed cost $A$ to order any item at the beginning of the period. 
\begin{exercise}
How would it change the newsvendor's problem?


\begin{solution}
We assume that we start the period with 0 inventories. 

If we do not order, the expected profit will be $P(0)=0$. If we order $\Q$ units, the expected profit will be $-A+P(\Q)$. T

It is important to see that, once the fixed ordering cost is paid, the optimal order level should be the same: the ordering level that maximizes $P(\Q)$ also  maximizes $-A+P(\Q)$. As a result of this, if we start with an inventory level of $0$, we should place an order only if $-A+P(\Q^*)>P(0)=0$. In other words, if $P(\Q^*)>A$ then it is worth to place an order. 
\end{solution}
\end{exercise}

\begin{exercise}
Assume that we have on-hand $x$ units at the beginning of the period. Should we place an order? 
\begin{solution}
The trade-off we discussed in the previous case is the same here. That is, once the fixed ordering cost is paid, the optimal order level and the optimal expected profit should be the same as in the case with no fixed ordering costs. However, this time we should consider the expected profit while conditioning on the number of items on hand. 

That is, we should compare $-A+P(x)$ with $cx+V_2(x)$.
\end{solution}
\end{exercise}



%\end{comment}

\Closesolutionfile{ans}
\opt{solutionfiles}{
\subsection{Solutions}
\input{ans}
}


\clearpage

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "inventory_notes"
%%% End:
